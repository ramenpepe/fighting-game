<head>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap"
    rel="stylesheet"
  />
  <style> 
    * {
      box-sizing: border-box;
      font-family: 'Press Start 2P', cursive;
    }
  </style>
</head>
<body>
  <!-- red container div -->
  <div style="position: relative; display: inline-block; width:100%;">
    <!-- smaller red container div -->
    <div
      style="
        position: absolute;
        display: flex;
        width: 100%;
        align-items: center;
        padding: 20px;
      "
    >
      <!-- player health -->
      <div
        style="
          position: relative;
          width: 100%;
          display: flex;
          justify-content: flex-end;
          border-top: 4px solid white;
          border-left: 4px solid white;
          border-bottom: 4px solid white;
        "
      >
        <div style="background-color: red; height: 30px; width: 100%"></div>
        <div
          id="playerHealth"
          style="
            position: absolute;
            background: #66b921;
            top: 0;
            right: 0;
            bottom: 0;
            width: 100%;
          "
        ></div>
      </div>

      <!-- timer -->
      <div
        id="timer"
        style="
          background-color: black;
          width: 100px;
          height: 50px;
          flex-shrink: 0;
          display: flex;
          align-items: center;
          justify-content: center;
          color: white;
          border: 4px solid white;
        "
      >
        10
      </div>
      <!-- enemy health -->
      <div
        style="
          position: relative;
          width: 100%;
          border-top: 4px solid white;
          border-bottom: 4px solid white;
          border-right: 4px solid white;
        "
      >
        <div style="background-color: red; height: 30px"></div>
        <div
          id="enemyHealth"
          style="
            position: absolute;
            background: #66b921;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
          "
        ></div>
      </div>
      <div></div>
    </div>
    <div
      id="displayText"
      style="
        position: absolute;
        color: white;
        align-items: center;
        justify-content: center;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        display: none;
      "
    >
      Tie
    </div>
    <canvas style="height: 90%;"></canvas>
  </div>

  <script
    src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.9.1/gsap.min.js"
    integrity="sha512-H6cPm97FAsgIKmlBA4s774vqoN24V5gSQL4yBTDOY2su2DeXZVhQPxFK4P6GPdnZqM9fg1G3cMv5wD7e6cFLZQ=="
    crossorigin="anonymous"
    referrerpolicy="no-referrer"
  ></script>
  <script src="js/utils.js"></script>
  <script src="js/classes.js"></script>
  <script src="index.js"></script>
  <style>
    button{ padding:25px;}
  </style>
  <div style="position:fixed; bottom:10px; left:10px; text-align:center; opacity:0.5;">
<button onmousedown="simulateKeydown('w',1)" onmouseup="simulateKeydown('w',0)">W</button><br/>
<button onmousedown="simulateKeydown('a',1)" onmouseup="simulateKeydown('a',0)">A</button>
<button onmousedown="simulateKeydown('s',1)" onmouseup="simulateKeydown('s',0)">S</button>
<button onmousedown="simulateKeydown('d',1)" onmouseup="simulateKeydown('d',0)">D</button>
</div>
  <script>
   
window.addEventListener('keydown', (event) => {
  if (!player.dead) {
    
    switch (event.key) {
      case 'd':
        keys.d.pressed = true
        player.lastKey = 'd'
        break
      case 'a':
        keys.a.pressed = true
        player.lastKey = 'a'
        break
      case 'w':
        console.log(player.position.y);
        if(player.position.y == 330){
        player.velocity.y = -20
      }
      
        break
        case 's':
        console.log('squat');
        break
      case 'j':
        player.attack()
        break
     case 'k':
        player.attack1()
        break
    }
    if(['dasjk'].includes(event.key)){
      player.comb.push(event.key);
    console.log(player.comb);

    }
  }

  if (!enemy.dead) {
    switch (event.key) {
      case 'ArrowRight':
        keys.ArrowRight.pressed = true
        enemy.lastKey = 'ArrowRight'
        break
      case 'ArrowLeft':
        keys.ArrowLeft.pressed = true
        enemy.lastKey = 'ArrowLeft'
        break
      case 'ArrowUp':
      if(enemy.position.y < 500){  
      console.log(enemy,player);
      enemy.velocity.y = -20
      }
       
        break
      case 'ArrowDown':
        enemy.attack()

        break
    }
  }
})

 // Detect keydown events for 'A' and 'W' keys
 document.addEventListener('keydown', function(event) {
  if (event.key === 'a' || event.key === 'A') {
    console.log('A key pressed');
    // Add your custom code for 'A' key press here
  }
  if (event.key === 'w' || event.key === 'W') {
    console.log('W key pressed');
    // Add your custom code for 'W' key press here
  }
});

// Detect swipe left, right, up, and down
let touchstartX = 0;
let touchendX = 0;
let touchstartY = 0;
let touchendY = 0;
const threshold = 50; // minimum distance to be considered a swipe

document.body.onmousedown = function() { 
  console.log(1);
}
function simulateKeydown(key,dir) {
  let event;
  if(dir == 0 ){
    console.log('end');
   event = new KeyboardEvent('keyup', { key: key });
   window.dispatchEvent(event);
}else{
    console.log('start');
    //    simulateKeydown('a'); // Example: simulate 'a' keydown when button is pressed
   event = new KeyboardEvent('keydown', { key: key });
   window.dispatchEvent(event);

}
 
}



function handleSwipe(dir) {
  const horizontalSwipeDistance = touchendX - touchstartX;
  const verticalSwipeDistance = touchendY - touchstartY;

  if (Math.abs(horizontalSwipeDistance) > Math.abs(verticalSwipeDistance)) {
    // Horizontal swipe
    if (horizontalSwipeDistance < -threshold) {
      console.log('Swiped left');
      simulateKeydown('a',dir);
    } else if (horizontalSwipeDistance > threshold) {
      console.log('Swiped right');
      simulateKeydown('d',dir);
    }
  } else {
    // Vertical swipe
    if (verticalSwipeDistance < -threshold) {
      console.log('Swiped up');
      simulateKeydown('w',dir);
    } else if (verticalSwipeDistance > threshold) {
      console.log('Swiped down');
    }
  }
}

window.addEventListener('touchstart', function(event) {
  touchstartX = event.changedTouches[0].screenX;
  touchstartY = event.changedTouches[0].screenY;
});


window.addEventListener('touchmove', function(event) {
  touchendX = event.changedTouches[0].screenX;
  touchendY = event.changedTouches[0].screenY;
  handleSwipe(1);
});

window.addEventListener('touchend', function(event) {
  touchendX = event.changedTouches[0].screenX;
  touchendY = event.changedTouches[0].screenY;
  handleSwipe(0);
});

window.addEventListener('keyup', (event) => {
  switch (event.key) {
    case 'd':
      keys.d.pressed = false
      break
    case 'a':
      keys.a.pressed = false
      break
  }

  // enemy keys
  switch (event.key) {
    case 'ArrowRight':
      keys.ArrowRight.pressed = false
      break
    case 'ArrowLeft':
      keys.ArrowLeft.pressed = false
      break
  }
})

  </script>

</body>
